import{C as F}from"./closest-index-BUfzSX6X.js";import{e as g}from"./timestamp-data-Dz1yihFk.js";function x(c){for(const s of c){if(typeof s.close=="number")return"close";if(typeof s.value=="number")return"value"}return null}function q(c,s,l){const p=l.primarySource??x(c);if(!p)throw new Error("Please provide a `primarySource` for the primary data of the correlation indicator.");const N=l.secondarySource??x(s);if(!N)throw new Error("Please provide a `secondarySource` for the secondary data of the correlation indicator.");g(c);const I=new F(g(s)),i=l.length,e=[],r=[];return c.map(u=>{const m={time:u.time},w=u[p];if(w===void 0)return e.push(NaN),r.push(NaN),e.length>i&&(e.shift(),r.shift()),m;const M=I.findClosestIndex(u.time,"left"),n=s[M],v=n==null?void 0:n[N],C=(n==null?void 0:n.time)===u.time;if(v===void 0||!l.allowMismatchedDates&&!C)return e.push(NaN),r.push(NaN),e.length>i&&(e.shift(),r.shift()),m;if(e.push(w),r.push(v),e.length>i&&(e.shift(),r.shift()),e.length<i||e.some(isNaN)||r.some(isNaN))return m;const f=i,h=e.reduce((o,t)=>o+t,0),d=r.reduce((o,t)=>o+t,0),y=e.reduce((o,t,E)=>o+t*r[E],0),V=e.reduce((o,t)=>o+t*t,0),X=r.reduce((o,t)=>o+t*t,0),Y=f*y-h*d,S=Math.sqrt((f*V-h*h)*(f*X-d*d));let a;return S===0?a=0:(a=Y/S,a=Math.max(-1,Math.min(1,a))),{time:u.time,value:a}})}export{q as c};
